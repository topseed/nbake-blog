extends /plugin/_layout

block head
	title #{title}

block main
	include /plugin/dropdown/_menu
	.ui.container
		.ui.segments
			.ui.segment
				p
				#cards.ui.three.column.stackable.grid

	script.
		var feed
		render = function(tag){
			var data = Object.assign({}, feed) //work on copy
			if (tag) {
				localStorage.setItem('tag', tag) //keep state
				data.items = data.items.filter(function(item){
					if (!item.tags) return false;
					return (item.tags.filter(function(t){ return tag.split(',').indexOf(t) > -1 })).length > 0
				})
			}
			else
				localStorage.removeItem('tag')
			$('#cards').html(itemsDBind(data)); 
			//itemsDBind is function in /blog/items_d.js, great Pug dynamic binding feature
		}
		loadjs.ready(['core'], function () {// load data
			fetch('/blog/items.json').then(function(resp) {
				return resp.json()
			}).then(function(json) {
				feed = json
				loadjs.ready(['dbind','site'], function() {
					render(localStorage.getItem('tag')) //first time, or after nav
				})
			})
		})
		loadjs.ready('core', function() {
			if (!loadjs.isDefined('dbind')) //need this for tsrouter.js
			{
				loadjs([
					'/home/items_d.js'
				],'dbind', {async: false})
			}
			else
				loadjs.done('dbind')
		})
